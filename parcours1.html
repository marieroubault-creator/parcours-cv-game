<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parcours à la carte interactif</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { margin:0; font-family:"Marianne",Arial,sans-serif; background: linear-gradient(180deg,#eef3ff 0%,#f7f7f7 100%); }
.ft-header { background:#406bde; color:white; text-align:center; padding:6px 0; font-weight:bold; }
.header { background:#1d1e3c; color:white; padding:16px; text-align:center; border-bottom:6px solid #6370c9; }
.header h1{margin:0;}
.action-bar { display:flex; justify-content:center; gap:20px; margin:12px 0; }
.back-home, .start-btn { padding:10px 18px; border-radius:30px; display:flex; align-items:center; gap:8px; font-weight:600; cursor:pointer; transition:0.2s; border:none; }
.back-home { background:#406bde; color:white; text-decoration:none; }
.back-home:hover{background:#3559b8;}
.start-btn { background:#ea6367; color:white; animation:pulse 2s infinite; }
.start-btn:hover{background:#d65256;}
@keyframes pulse { 0% {box-shadow:0 0 0 0 rgba(234,99,103,0.7);} 70% {box-shadow:0 0 0 14px rgba(234,99,103,0);} 100% {box-shadow:0 0 0 0 rgba(234,99,103,0);} }

#map-container {
    display:flex;
    justify-content:center;
    position:relative;
    padding-bottom:100px; /* espace pour le footer */
}

#map {
    height:calc(75vh - 40px); /* réduit un peu pour laisser le footer visible */
    width:90%;
    max-width:1000px;
    border:4px solid #1d1e3c;
    border-radius:12px;
}


#confetti-canvas { position:absolute; inset:0; pointer-events:none; }

.modal-bg { position:fixed; inset:0; background:rgba(0,0,0,0.55); display:flex; justify-content:center; align-items:center; z-index:9999; }
.modal { background:white; padding:20px; border-radius:12px; border:3px solid #1d1e3c; width:320px; text-align:center; position:relative; }
.modal button { background:#1d1e3c; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; margin-top:12px; }
.close-btn { position:absolute; top:8px; right:12px; font-size:20px; cursor:pointer; }

.next-point-popup { background:#406BDE; color:white; border-radius:8px; text-align:center; padding:4px 8px; font-weight:bold; cursor:pointer; box-shadow:0 0 10px gold; animation:pulsePopup 1.5s infinite; }
@keyframes pulsePopup { 0% { transform: scale(1); box-shadow:0 0 10px gold; } 50% { transform: scale(1.1); box-shadow:0 0 20px gold; } 100% { transform: scale(1); box-shadow:0 0 10px gold; } }

#scoreboard { position:absolute; top:120px; left:20px; background:white; padding:8px 12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); font-weight:bold; z-index:50; }

.footer { position:fixed; bottom:0; left:0; width:100%; background:#a9c4ff; color:#1d1e3c; text-align:center; padding:12px 10px; font-size:0.95rem; }
</style>
</head>

<body>
<div class="ft-header">FRANCE TRAVAIL</div>
<div class="header"><h1>Parcours à la carte interactif</h1></div>

<!-- Boutons centrés -->
<div class="action-bar">
  <a href="index.html" class="back-home"><i class="fa-solid fa-house"></i> Retour à l’accueil</a>
  <button id="start-btn" class="start-btn"><i class="fa-solid fa-play"></i> Cliquez ici pour commencer</button>
</div>

<!-- Score + Timer -->
<div id="scoreboard">Score: <span id="score">0</span> | Temps restant: <span id="timer">50:00</span></div>

<div id="map-container">
  <div id="map"></div>
  <canvas id="confetti-canvas"></canvas>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
// MAP
let map = L.map('map').setView([48.6519962, -2.0182998], 16);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
setTimeout(()=>{ map.invalidateSize(); }, 200);

// CONFETTI plein écran
const confettiCanvas = document.getElementById('confetti-canvas');
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
const myConfetti = confetti.create(confettiCanvas, { resize:true, useWorker:true });
function launchConfettiFullScreen(){
    for(let i=0;i<3;i++){
        myConfetti({
            particleCount:100,
            spread:160,
            origin:{x:Math.random(),y:Math.random()},
            gravity:0.7
        });
    }
}

// PARCOURS

const parcours = [
  {
    key:"start",
    name:"Monsieur Madame",
    coords:[48.64652164024668, -2.0263622722532184],
    address:"2 rue de Dinan, 35400 Saint-Malo",
    website:"https://monsieurmadamebrasserie.com/fr",
    q:"Quel est le plat emblématique de l'Ille et Vilaine ?",
    a:"La galette saucisse"
  },
  {
    key:"pt1",
    name:"La Brasserie Armoricaine",
    coords:[48.6490533769641, -2.0273456587614365],
    address:"6 Rue du Boyer, 35400 Saint-Malo",
    website:"https://www.hotel-armoricaine.com/",
    q:"Comment s’appelle la muraille qui entoure la vieille ville ?",
    a:"Les remparts"
  },

{ key:"pt2", name:"Le croiseur Ginette", coords:[48.64973426972223, -2.024604330109633],  
    address:"2 place de la poissonnerie, 35400 Saint-Malo",
    website:"https://www.lecroiseur-ginette.com/",
    q:"Comment s'appelle le palais de Saint-Malo ?",
    a:"Le palais du grand large"
}, 

{ key:"pt3", name:"Cavoua coffee spot", coords:[48.65025552662146, -2.0239766293855572], 
address:"3 Rue des Orbettes, 35400 Saint-Malo",
    website:"https://bonjour.cavoua.fr/summer",
    q:"Comment s'appelle la fête foraine de Saint-Malo ?",
    a:"La Sainte Ouine"
},
{ key:"pt4", name:"Le Cambusier", coords:[48.64801544576959, -2.024409816433667], 
address:"6 rue des Cordiers, 35400 Saint-Malo",
    website:"https://www.cambusier.fr/",
    q:"Quel animal est l'emblême de la Bretagne ?",
    a:"L'hermine"
}, 
{ key:"pt5", name:"Breizh Café", coords:[48.64816104207073, -2.0254269123503805],
    address:"5 place du Marché aux légumes, 35400 Saint-Malo",
    website:"https://lamaisondusarrasin.fr/",
    q:"Comment s’appelle l’île célèbre accessible à marée basse depuis Saint-Malo ?",
    a:"Grand bé"
},
];

let currentIndex=0;
let score=0;

// TIMER 50 minutes
let totalSeconds = 50*60;
const timerInterval = setInterval(()=>{
    let m = Math.floor(totalSeconds/60);
    let s = totalSeconds%60;
    document.getElementById("timer").textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    if(totalSeconds-- <=0){
        clearInterval(timerInterval);
        alert("Temps écoulé ! Fin du parcours.");
        location.reload();
    }
},1000);

// START
document.getElementById("start-btn").addEventListener("click", ()=>{
    document.getElementById("start-btn").style.display="none";
    addNextPoint();
});

// Ajouter point suivant
function addNextPoint(){
    if(currentIndex >= parcours.length) return;
    const point = parcours[currentIndex];
    const marker = L.marker(point.coords).addTo(map);

    const div = L.DomUtil.create('div','next-point-popup');
    div.innerHTML = `<b>${point.name}</b><br><i>Cliquez ici pour la question</i>`;
    L.DomEvent.on(div,'click',()=> showQuestion(point, marker, div));
div.innerHTML = `
  <b>${point.name}</b><br>
  <span style="font-size:0.85em; line-height:1.3;">
     ${point.address}<br>
     <a href="${point.website}" target="_blank" style="color:white;text-decoration:underline;">
      Site web
    </a>
  </span><br>
  <i>Cliquez ici pour la question</i>
`;

    const popup = L.popup({closeButton:false, autoClose:false, closeOnClick:false})
        .setLatLng(point.coords)
        .setContent(div)
        .openOn(map);
}

// Afficher question modal
function showQuestion(point, marker, div){
    if(div) map.closePopup();
    const modal = document.createElement("div");
    modal.className="modal-bg";
    modal.innerHTML=`<div class="modal">
        <span class="close-btn" onclick="this.closest('.modal-bg').remove()">×</span>
        <h3>${point.name}</h3>
        <p>${point.q}</p>
        <input id="answer" style="width:90%"><br>
        <button id="validate-btn">Valider</button>
    </div>`;
    document.body.appendChild(modal);

    document.getElementById("validate-btn").addEventListener("click", ()=>{
        const val = document.getElementById("answer").value.toLowerCase().trim();
        if(val === point.a.toLowerCase()){
            modal.remove();
            score++;
            document.getElementById("score").textContent = score;
            launchConfettiFullScreen();
            currentIndex++;
            addNextPoint();
        } else alert("Mauvaise réponse !");
    });
}
</script>

<footer class="footer">  © France Travail – Parcours à la carte | Dites le nous une fois</footer>
</body>
</html>

